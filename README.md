# 3RR_Fuzzy_Control
Performance Analysis of PID and Fuzzy Controllers for Position Control of a 3R Robot Manipulator
Sina Ghanaat
Dept of Mechanical Engineering,
K. N. Toosi University of Technology, Tehran, Iran
 
 
Abstract—This is the first of three projects for the “AIES” course instructed by Dr. Esmaeil Najafi at the Department of Mechanical Engineering of K. N. Toosi university of technology. In this project, a PID controller and a Fuzzy controller have been implemented virtually on a 3R serial manipulator suggested by the project outline.
Keywords—Serial Manipulator, PID Control, Gain Tuning, Fuzzy Control, 
Introduction
3R Manipulator Kinematic Model
By acquiring D-H, forward kinematic model has been derived and presented in the Simulink model, thus the task space of the manipulator van bee drawn.

 
Figure 1 Task space for 3R manipulator

Manipulator Dynamic Model
Dynamic model of this robot has been given in AIES_appendix.
Path Generation
The objective for this manipulator is to move the end effector from an arbitrary point A to an arbitrary point B. By assumption, all measurement units are actively mounted on joints and no cartesian measuring is in action. Therefore, in order to control this manipulator, cartesian represented point A and B will be mapped onto joint space. Then for each joint, a linear trajectory with blend section has been derived. Both controllers will force all three joints to follow that trajectory.
The invers kinematics of the manipulator for initial and final arbitrary points results in 4 different configurations for following the trajectory. This can be shown in Figure 3.
Arbitrary point A and B are given below

A= (■(0.5@0@1.5))
B= (■(-0.5@-0.7@1.5))

 
Figure 2 two configurations for joint 2 and 3 at a common end effector position
 
Figure 3 all 4 cartesian path achieved by 4 different configurations of manipulator
We only choose one configuration along with considering angular position of joint 3 must not have a value of 0 which resulted in manipulator singularity.
PID Controller
In this project, each joint will be controlled independently from the other two. Considering the dynamic model’s nonlinearity and coupled equations, designing a robust PID controller will be challenge. Also, by taking into account that the torque generated by joint 2 will affect joint 3 and vice versa, tuning PID gains by linear estimations is not an option because torque generated by joint 2 act as a disturbance on joint 3.
There are several procedures by which PID gains can be tuned, however in this project, a manual by trial an error tuning is done.
 
Figure 4 Simulink PID control scheme
Two cases have been considered in order to evaluate the PID controller performance:

1. Initial condition matches trajectory initial state

2. Initial condition differs from trajectory’s initial state

  
Figure 5 inside of PID control block
 
Figure 6 joint PID block
Two cases have been considered in order to evaluate the PID controller performance:

1. Initial condition matches trajectory initial state
2. Initial condition differs from trajectory’s initial state

Initial Condition Matches Trajectory Initial State
After numerous trials and error and according to the behavior of all PID gains against error, three sets of gains have been achieved.

For joint 1:
K_p= 30
K_d= 20
K_i=0 

For joint 2
K_p= 40
K_d= 15
K_i= 30

For joint 3
K_p= 50
K_d= 15
K_i= 30

We can see that joint 1 doesn’t experience any internal disturbance resulted from other joints, there for in absence of external disturbance, no integrator is needed and a PD controller will simply do the work.
Results
 
Figure 7 Error for angular position of all three joints
 
Figure 8 Control input generated by PID block
 
Figure 9 Trajectory tracking by all three joints
Figure 7 shows error for angular position of the robot joints. The maximum error while tracking the trajectory is 0.03 rad which is considerably good for a linear PID controller with a highly nonlinear coupled manipulator. 
The control input which is presented in Figure 8 shows a boundary of 4 and -4 unit of input. 
Finally, we can see the trajectory tracking by PID controller for all three joints in Figure 9 which small deviation can bee seen but not more than a reasonable threshold. 
Initial Condition Differ Frome Trajectory’s Initial State
In this section, an initial condition different from initial state of the desired trajectory has been chosen for initial state of the end effector.

Initial joint values= (■(0@0@0.1))

Results
 
Figure 10 Error for angular position of all three joints
 
Figure 11 Control input generated by PID block

 
Figure 12 Trajectory tracking by all three joints
As we can see in Figure 10, tracking the trajectory is hurt by a large value of error for a sort amount of time. After getting approached to the desired trajectory, this error is faded and a tracking continues with a reasonable threshold of error. However, Figure 12 illustrates a high slop at the very beginning of the tracking by joint 2 and 3. This indicates that a high-speed tracking is active. This can cause some problems. In this project a boundary for joint velocities is chosen between -3 and 3 rad/sec. by decreasing this value, PID controller may not be able to track the trajectory as proper as it may now.
Figure 11 and 12 show that higher torques needed for the actuator to track in this situation. 
Fuzzy Controller
Fuzzy Control Structure
The fuzzy controller scheme is shown in Figure 14. Fuzzy controllers can handle nonlinearity very well if a proper rule structures have been designed. But in this project, nonlinearity is not a challenge alone, coupled input for joint 2 and 3 is a far more important challenge. Multiple attempts have been made in order to make the Fuzzy controller track the desired trajectory but non give some in return. While the joint 1 behaved really well, the other two suffer from affecting each other’s tracking quality.
Thus, in order to decouple these two joints and yet taking their coupled effects into account, a switching scheme has been implemented. In this scheme, joint 1 and 2 will be controlled independently at very small-time interval. If joint 1 is controlled at the specific time span, the other one is shut down. If this time span is small enough, then we can expect a reasonable behavior from both joints. Since at each time step, each joint tries to correct itself independently by ignoring the other’s disturbance effect. The frequency of switching is 50 Hz.
 
Figure 14 Fuzzy controller scheme with switching mechanism
Fuzzy Memebreship Function
 
Figure 15 Membership function for Error of joint 1
 
Figure 16 Membership function for Errordot of joint 1
 
Figure 17 Membership function for control effort of joint 1
 
Figure 18 Membership function for Error of joint 2 and 3
 And  
Figure 19 Membership function for Errordot of joint 2 and 3
 
Figure 20 Membership function for control effort of joint 2 and 3
The fuzzy inference system is Mamadani with centroid as defuzzification method. The membership function for all three joints have been illustrated in Figure 15 to 20. Joint 1 is decoupled from other joints torque so ultimately the error has more priority than errordot, while for the other two joints, both error and errordot have same priorities since they act as a disturbance source for each other. Therefore, the error membership functions for all three joints have drawn in such way to make system sensitive. While for errordot, only joint 2 and 3 are sensitive to it. By making joints more sensitive we can expect a better tracking behavior at the cost of mor control input bouncing. So, if we are not thoughtful, we may cause the system to go into an oscillatory phase or perhaps in an unstable state.
Rules
For this manipulator, a general rule concept can be shown below.
	If Error is Negative and Errordot is Negative then Input is Negative
	If Error is Positive and Errordot is Positive then Input is Positive
	If Error is Negative and Errordot is Positive then Input is Negative/Zero *
	If Error is Positive and Errordot is Negative then Input is Positive/Zero *
	If Error is Zero and Errordot is Zero then Input is Zero
The input for (*) Rules can be both. This is dependent on the choice of designer. By acquiring non zero inputs, the reacting speed of system will increase along with the chance for going through unstable phase.
All rules for this project have been saved in “FC1.fis”, “FC2.fis” and “FC3.fis”.
Results
 
Figure 21 Error for angular position of all three joints
 
Figure 22 Control input generated by PID block
 
Figure 23 Trajectory tracking by all three joints
As shown in Figure 21, a quite reasonable error has been achieved by this method. However, since high frequency switching is in progress, error suffer from this high frequency changes too. 
Control effort for both joint 1 and 2 also suffer from high frequency changes from switching mechanism as shown in Figure 22. We can see that for the most of the time, control inputs for joint 2 and 3 have value of the upper and lower end of the boundary. This alone can show that there is a flaw in fuzzy control structure design.
Figure 23 shows a well behaved (not as PID) trajectory tracking by this Fuzzy controller.
Conclusion
PID controller handles the nonlinear coupled dynamic under aforementioned trajectory very well both at initial condition of trajectory and at an arbitrary one but its performance under noise and disturbance has not been studied. In this Project, Fuzzy Controller could not handle coupled dynamic of the manipulator. Therefore, a switching circuit has been designed in order to execute FCU for joint 1 and 2 independently. Switching mechanism resulted in a reasonable trajectory tracking at the cost of actuator chirping. Since actual actuators experience some level of inertia, we can conclude that an actual implementation of this mechanism results in a smoother control effort. A proper alternative for Fuzzy Control Structure presented in this project could have been a Fuzzy PID structure, which can benefit from both Fuzzy’s simplistic reasoning and PID’s low computational cost and easy to implement structure.
Refrences 

